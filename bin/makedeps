#!/usr/bin/env bb

(ns makedeps
  (:require [clojure.tools.cli :as cli]
            [clojure.pprint :as pprint]))

(def clojure-version "1.10.1")
(def clojurescript-version "1.10.741")
(def cider-nrepl-version "0.24.0")
(def piggieback-version "0.4.2")

(def base-deps-map
  `{:paths ["src"]
    :deps {org.clojure/clojure {:mvn/version ~clojure-version}}
    :aliases
    {:dev
     {:extra-deps
      {cider/cider-nrepl {:mvn/version ~cider-nrepl-version}}}}})

(defn add-cljs
  [deps-map]
  (-> deps-map
      (assoc-in [:deps 'org.clojure/clojurescript]
                {:mvn/version clojurescript-version})
      (assoc-in [:aliases :dev :extra-deps 'cider/piggieback]
                {:mvn/version piggieback-version})))

(def opts
  [[nil "--cljs"]])

(let [{:keys [options]}
      (cli/parse-opts *command-line-args* opts)
      final-map (if (:cljs options)
                  (add-cljs base-deps-map)
                  base-deps-map)]
  (pprint/pprint final-map))
